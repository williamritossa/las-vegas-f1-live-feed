<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Las Vegas GP â€“ Track + Live Cams</title>
  <link rel="preconnect" href="https://upload.wikimedia.org">
  <link rel="preconnect" href="https://unpkg.com">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <style>
    :root {
      --bg: #0c0d14;
      --panel: #161822;
      --accent: #ff355d;
      --text: #f5f7ff;
      --muted: #9aa3c7;
      --radius: 14px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Inter", system-ui, -apple-system, sans-serif;
      background: #0c0d14;
      color: var(--text);
      min-height: 100vh;
      overflow: hidden;
    }
    #map {
      position: fixed;
      inset: 0;
      z-index: 1;
      filter: saturate(1.1);
    }
    .scrim {
      position: fixed;
      inset: 0;
      background: none;
      z-index: 2;
      pointer-events: none;
    }
    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      display: grid;
      gap: 18px;
      padding: 16px 18px;
      grid-template-columns: minmax(0, 1fr) 320px;
      align-items: center;
      z-index: 3;
      backdrop-filter: blur(12px);
      background: linear-gradient(90deg, rgba(12,13,20,0.75), rgba(12,13,20,0.4));
      border-bottom: 1px solid #1f2130;
    }
    @media (max-width: 900px) {
      header { grid-template-columns: 1fr; }
    }
    h1 {
      margin: 0 0 10px;
      font-size: clamp(1.7rem, 2vw + 1rem, 2.4rem);
      letter-spacing: 0.03em;
    }
    p {
      margin: 0;
      color: var(--muted);
      line-height: 1.5;
    }
    .map-wrap { display: none; } /* hidden legacy block */
    .leaflet-popup-content {
      margin: 8px 8px 10px;
    }
    .popup-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 700;
      margin-bottom: 6px;
    }
    .popup-title::before {
      content: "";
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 12px rgba(255,53,93,0.6);
    }
    .popup-video {
      width: 320px;
      max-width: 70vw;
      aspect-ratio: 16 / 9;
      border-radius: 10px;
      background: #000;
      display: block;
    }
    .legend {
      position: fixed;
      bottom: 16px;
      right: 16px;
      background: rgba(12,13,20,0.78);
      border: 1px solid #1f2130;
      border-radius: var(--radius);
      padding: 12px 14px;
      color: var(--muted);
      z-index: 3;
      font-size: 0.92rem;
      max-width: 320px;
      line-height: 1.45;
      backdrop-filter: blur(8px);
    }
    .cam-marker {
      width: 26px;
      height: 26px;
      border-radius: 50%;
      background: #e8ebf5;
      border: 2px solid #c5cbdd;
      display: grid;
      place-items: center;
      color: #1b1d29;
      font-size: 14px;
      box-shadow: 0 0 10px rgba(0,0,0,0.4);
    }
    .side-panel {
      position: fixed;
      z-index: 3;
      overflow: auto;
      padding: 10px;
      display: grid;
      gap: 12px;
      background: rgba(12,13,20,0.82);
      border: 1px solid #1f2130;
      border-radius: var(--radius);
      backdrop-filter: blur(12px);
      box-shadow: 0 12px 35px rgba(0,0,0,0.4);
      max-width: 420px;
    }
    body[data-panel="right"] .side-panel {
      top: 110px; right: 12px; bottom: 70px; width: 410px; left: auto;
    }
    body[data-panel="left"] .side-panel {
      top: 110px; left: 12px; bottom: 70px; width: 410px;
    }
    body[data-panel="top"] .side-panel {
      left: 12px; right: 12px; top: 110px; height: 34vh; max-width: none;
      display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    }
    body[data-panel="bottom"] .side-panel {
      left: 12px; right: 12px; bottom: 12px; height: 38vh; max-width: none;
      display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    }
    @media (max-width: 980px) {
      body[data-panel="right"] .side-panel,
      body[data-panel="left"] .side-panel {
        left: 12px; right: 12px; width: auto; bottom: 12px; top: auto; height: 48vh;
      }
      body[data-panel="top"] .side-panel { height: 42vh; top: 110px; }
      body[data-panel="bottom"] .side-panel { height: 42vh; }
    }
    .panel-title {
      margin: 4px 6px 4px;
      font-weight: 700;
      letter-spacing: 0.01em;
    }
    .control-row.compact {
      gap: 6px;
    }
    .card {
      background: #161822;
      border-radius: var(--radius);
      padding: 12px;
      border: 1px solid #222536;
      box-shadow: 0 10px 28px rgba(0,0,0,0.35);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .card.highlight {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(255,53,93,0.55), 0 14px 32px rgba(0,0,0,0.45);
      transition: box-shadow 0.2s ease, border-color 0.2s ease;
    }
    .chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 0.92rem;
      color: var(--muted);
    }
    .chip::before {
      content: "";
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 14px rgba(255,53,93,0.6);
    }
    .card video {
      width: 100%;
      aspect-ratio: 16 / 9;
      border-radius: calc(var(--radius) - 4px);
      background: #000;
    }
    .controls { display: none; }
    .coord-box {
      position: fixed;
      bottom: 14px;
      left: 14px;
      z-index: 4;
      background: rgba(12,13,20,0.82);
      border: 1px solid #1f2130;
      border-radius: 10px;
      padding: 8px 10px;
      color: var(--muted);
      font-size: 0.9rem;
      line-height: 1.3;
      box-shadow: 0 10px 28px rgba(0,0,0,0.35);
      pointer-events: none;
    }
    .coord-box strong { color: var(--text); }
    .coord-status { color: var(--accent); }
  </style>
</head>
  <body>
    <div class="controls">
      <div class="compass">
        <div class="needle"></div>
        <div class="arrow arrow-left">âŸ²</div>
        <div class="arrow arrow-right">âŸ³</div>
      </div>
    </div>
    <div class="coord-box" id="coordBox" style="display:none;">
      <div><strong>Track point</strong></div>
      <div id="coordText">â€“</div>
      <div class="coord-status" id="coordStatus"></div>
    </div>
    <div id="map"></div>
    <div class="scrim"></div>
    <header>
      <div>
        <h1>Las Vegas Grand Prix â€“ live from NDOT cams</h1>
        <p style="margin-top:6px; font-size:0.95rem; color:#c3c9e2;">
          Feeds: <a href="https://www.nvroads.com/" target="_blank" rel="noreferrer" style="color:#8fb4ff;">NVROADS</a> &nbsp;â€¢&nbsp; Imagery: <a href="https://www.esri.com/en-us/arcgis/about-arcgis/overview" target="_blank" rel="noreferrer" style="color:#8fb4ff;">Esri World Imagery</a>
        </p>
      </div>
      <div class="map-wrap">
        <img
          class="map"
          src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/43/2023_Las_Vegas_street_circuit.svg/1280px-2023_Las_Vegas_street_circuit.svg.png"
          alt="Las Vegas GP track map"
          onerror="this.style.display='none';">
      </div>
    </header>

    <div class="side-panel" id="sidePanel">
      <div class="panel-title">Trackside cameras</div>
      <div class="control-row compact" style="margin: 0 6px 6px;">
        <button class="btn dock-btn" data-pos="left">Left</button>
        <button class="btn dock-btn" data-pos="top">Top</button>
        <button class="btn dock-btn" data-pos="right">Right</button>
        <button class="btn dock-btn" data-pos="bottom">Bottom</button>
      </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/hls.js@1.5.14/dist/hls.min.js"></script>
    <script>
      const cams = [
        { name: "Sands Ave & Palazzo â€“ Sphere", url: "https://d1wse4.its.nv.gov:443/vegasxcd04/84512278-97ad-4bc7-af27-24d3251c6396_lvflirxcd04_public.stream/playlist.m3u8", lat: 36.124877, lng: -115.167146 },
        { name: "Las Vegas Blvd & Spring Mountain â€“ Sphere", url: "https://d1wse2.its.nv.gov:443/vegasxcd02/d30da79c-c940-4369-8b3b-3cb086aaec28_lvflirxcd03_public.stream/playlist.m3u8", lat: 36.125587, lng: -115.169270 },
        { name: "Las Vegas Blvd & Sirens Cove Blvdâ€“Palazzo", url: "https://d1wse3.its.nv.gov:443/vegasxcd03/3bd493c4-4dc4-49f1-9238-a1753f23829b_lvflirxcd04_public.stream/playlist.m3u8", lat: 36.123343, lng: -115.170836 },
        { name: "Las Vegas Blvd & Mirageâ€“Venetian", url: "https://d1wse2.its.nv.gov:443/vegasxcd02/3d995f6b-442b-4fd0-a2b1-5c08245dc063_lvflirxcd03_public.stream/playlist.m3u8", lat: 36.122138, lng: -115.171630 },
        { name: "Las Vegas Blvd & Harrahsâ€“Mirage Exit", url: "https://d1wse2.its.nv.gov:443/vegasxcd02/6dc51cf7-33ad-454d-b129-b6043b4fc1f1_lvflirxcd03_public.stream/playlist.m3u8", lat: 36.120171, lng: -115.172478 },
        { name: "Las Vegas Blvd & Caesars Dr", url: "https://d1wse2.its.nv.gov:443/vegasxcd02/164d50b6-4c0c-44ca-bb80-8dae3666f214_lvflirxcd03_public.stream/playlist.m3u8", lat: 36.117389, lng: -115.173014 },
        { name: "Flamingo Rd & Las Vegas Blvd", url: "https://d1wse3.its.nv.gov:443/vegasxcd03/c250fce9-1e47-479e-99eb-a28ba37fe962_lvflirxcd03_public.stream/playlist.m3u8", lat: 36.114607, lng: -115.172971 },
        { name: "Las Vegas Blvd & Bellagio", url: "https://d1wse2.its.nv.gov:443/vegasxcd02/333a58ca-72ea-4ca8-a641-b9bb0579b4ed_lvflirxcd03_public.stream/playlist.m3u8", lat: 36.111305, lng: -115.173122 },
        { name: "Las Vegas Blvd & Harmon Ave Medianâ€“Cosmo", url: "https://d1wse2.its.nv.gov:443/vegasxcd02/fe3007b2-972a-4c91-ab9e-985a9109f9d6_lvflirxcd03_public.stream/playlist.m3u8", lat: 36.108514, lng: -115.173004 }
      ];

      const map = L.map("map", {
        zoomControl: false,
        minZoom: 14,
        maxZoom: 18,
        attributionControl: false
      });

      L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}", {
        maxZoom: 18,
        attribution: "&copy; <a href='https://www.esri.com/'>Esri</a>, Maxar"
      }).addTo(map);

      L.control.zoom({ position: "bottomright" }).addTo(map);

      const hlsPlayers = new Map();
      document.body.dataset.panel = "right";

      function mountPlayer(videoEl, url) {
        if (videoEl.canPlayType("application/vnd.apple.mpegurl")) {
          videoEl.src = url;
        } else if (window.Hls && Hls.isSupported()) {
          const hls = new Hls({ liveDurationInfinity: true });
          hls.loadSource(url);
          hls.attachMedia(videoEl);
          hlsPlayers.set(videoEl, hls);
        } else {
          videoEl.insertAdjacentHTML("afterend", "<p style='color:#f6d55c'>HLS not supported in this browser.</p>");
        }
      }

      // Dock control
      document.querySelectorAll(".dock-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          const pos = btn.dataset.pos;
          document.body.dataset.panel = pos;
        });
      });

      // Track hover helper
      const coordBox = document.getElementById("coordBox");
      const coordText = document.getElementById("coordText");
      const coordStatus = document.getElementById("coordStatus");
      function showCoord(latlng) {
        coordBox.style.display = "block";
        coordText.textContent = `${latlng.lat.toFixed(6)}, ${latlng.lng.toFixed(6)}`;
        coordStatus.textContent = "";
      }
      function hideCoord() {
        coordBox.style.display = "none";
        coordStatus.textContent = "";
      }
      function copyCoord(latlng) {
        const text = `${latlng.lat.toFixed(6)}, ${latlng.lng.toFixed(6)}`;
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(text).then(() => {
            coordStatus.textContent = "Copied to clipboard";
          }).catch(() => {
            coordStatus.textContent = "Copy failed";
          });
        } else {
          coordStatus.textContent = text;
        }
      }

      cams.forEach((cam, idx) => {
        const marker = L.marker([cam.lat, cam.lng], {
          icon: L.divIcon({
            className: "",
            html: `<div class="cam-marker">ðŸ“·</div>`,
            iconSize: [26, 26],
            iconAnchor: [13, 13]
          })
        }).addTo(map);

        marker.on("click", () => {
          const card = document.getElementById(`card-${idx}`);
          if (card) {
            card.scrollIntoView({ behavior: "smooth", block: "center" });
            card.classList.add("highlight");
            setTimeout(() => card.classList.remove("highlight"), 1800);
          }
        });
      });

      // Side panel cards
      const sidePanel = document.getElementById("sidePanel");
      cams.forEach((cam, idx) => {
        const card = document.createElement("div");
        card.className = "card";
        card.id = `card-${idx}`;

        const title = document.createElement("div");
        title.className = "chip";
        title.textContent = cam.name;
        card.appendChild(title);

        const video = document.createElement("video");
        video.controls = true;
        video.autoplay = true;
        video.muted = true;
        video.playsInline = true;
        video.id = `list-${idx}`;
        card.appendChild(video);

        mountPlayer(video, cam.url);
        sidePanel.appendChild(card);
      });

      // Track overlay from embedded GeoJSON (us-2023.geojson)
      const trackGeojson = {"type":"FeatureCollection","name":"us-2023","bbox":[-115.173181,36.107928,-115.160107,36.12554],"features":[{"type":"Feature","properties":{"id":"us-2023","Location":"Las Vegas","Name":"Las Vegas Street Circuit","opened":2023,"firstgp":2023,"length":6201,"altitude":610},"bbox":[-115.173181,36.107928,-115.160107,36.12554],"geometry":{"type":"LineString","coordinates":[[-115.161202,36.109904],[-115.160589,36.110461],[-115.160459,36.110578],[-115.160366,36.110705],[-115.160335,36.110856],[-115.160414,36.110992],[-115.160543,36.111079],[-115.160775,36.11115],[-115.160996,36.111179],[-115.161209,36.111169],[-115.161408,36.111121],[-115.161844,36.110909],[-115.162247,36.110586],[-115.162402,36.110503],[-115.162741,36.110442],[-115.162924,36.110445],[-115.163255,36.110535],[-115.163438,36.110617],[-115.163608,36.110734],[-115.16389,36.111042],[-115.164004,36.111303],[-115.164082,36.119035],[-115.164023,36.119152],[-115.163908,36.119211],[-115.161934,36.119181],[-115.161342,36.119184],[-115.161033,36.119242],[-115.160908,36.119329],[-115.160559,36.119604],[-115.160402,36.119783],[-115.160282,36.119976],[-115.160195,36.120145],[-115.160143,36.120365],[-115.160107,36.120627],[-115.160117,36.120781],[-115.160225,36.120836],[-115.160511,36.120862],[-115.160611,36.120913],[-115.160697,36.12102],[-115.160731,36.121187],[-115.160715,36.121309],[-115.160438,36.121696],[-115.16039,36.121799],[-115.160274,36.121977],[-115.160316,36.122164],[-115.160541,36.122284],[-115.160959,36.122322],[-115.164089,36.122386],[-115.165245,36.122522],[-115.165627,36.122671],[-115.166049,36.123022],[-115.166411,36.123607],[-115.166965,36.124659],[-115.167321,36.124962],[-115.16769,36.125167],[-115.168065,36.125279],[-115.168652,36.125432],[-115.169318,36.12554],[-115.169409,36.125522],[-115.169496,36.125468],[-115.169564,36.125284],[-115.169633,36.125158],[-115.170324,36.124067],[-115.170754,36.123418],[-115.170978,36.123089],[-115.171208,36.122772],[-115.171605,36.122215],[-115.172013,36.121466],[-115.172229,36.1209],[-115.172466,36.120249],[-115.172625,36.119783],[-115.172744,36.119319],[-115.172839,36.118849],[-115.17294,36.11816],[-115.172965,36.117758],[-115.172991,36.117279],[-115.17298,36.115982],[-115.172974,36.115241],[-115.172971,36.114679],[-115.173104,36.111742],[-115.173144,36.110235],[-115.173145,36.109483],[-115.173181,36.108577],[-115.173118,36.108504],[-115.173032,36.10848],[-115.172826,36.108483],[-115.172674,36.108436],[-115.172332,36.108159],[-115.172033,36.108021],[-115.171635,36.107958],[-115.169902,36.107928],[-115.167635,36.10795],[-115.16577,36.107941],[-115.164859,36.107951],[-115.164113,36.108035],[-115.163333,36.108155],[-115.16313,36.10823],[-115.162966,36.108313],[-115.162835,36.108413],[-115.161202,36.109904]]}}]};

      // Center map from GeoJSON bbox
      if (trackGeojson.bbox && trackGeojson.bbox.length === 4) {
        const [minLng, minLat, maxLng, maxLat] = trackGeojson.bbox;
        const centerLat = (minLat + maxLat) / 2;
        const centerLng = (minLng + maxLng) / 2;
        map.setView([centerLat, centerLng], 14.5);
      } else {
        map.setView([36.116734, -115.166644], 14.5);
      }

      const baseTrack = L.geoJSON(trackGeojson, {
        style: {
          color: "#ff355d",
          weight: 6,
          opacity: 0.85
        }
      }).addTo(map);
      const dashTrack = L.geoJSON(trackGeojson, {
        style: {
          color: "#ffffff",
          weight: 2,
          opacity: 0.7,
          dashArray: "8 8"
        }
      }).addTo(map);

      baseTrack.on("mouseover", (e) => showCoord(e.latlng));
      baseTrack.on("mousemove", (e) => showCoord(e.latlng));
      baseTrack.on("mouseout", hideCoord);
      baseTrack.on("click", (e) => copyCoord(e.latlng));
    </script>
  </body>
</html>
